<ng-container *ngFor="let task of tasks; trackBy: trackById">
  <mat-card class="task-card">

    <!-- HEADER: título + badge de estado + botón eliminar -->
    <div
      class="task-card-header"
      [ngStyle]="{ 'background': gradientMap[ task.status.name ] || 'transparent' }"
    >
      <div class="task-title">{{ task.name }}</div>

      <div class="header-actions">
        <!-- Botón Eliminar solo en To do -->
        <button
          mat-icon-button
          *ngIf="task.status.name === 'To do'"
          (click)="onDeleteClick(task, $event)"
          aria-label="Eliminar tarea"
        >
          <mat-icon>delete</mat-icon>
        </button>

        <!-- Badge de estado -->
        <span
          class="status-badge"
          [ngClass]="{
            high:   task.status.name === 'High',
            medium: task.status.name === 'Medium',
            low:    task.status.name === 'Low'
          }"
        >
          {{ task.status.name }}
        </span>
      </div>
    </div>

    <!-- NUEVO: etiquetas -->
    <div class="label-container">
      <span
        *ngFor="let label of task.labels"
        class="label-badge"
        [style.backgroundColor]="label.color"
      >
        {{ label.name }}
      </span>
    </div>

    <!-- CONTENIDO: descripción -->
    <mat-card-content class="task-content">
      <p>{{ task.description }}</p>
    </mat-card-content>

    <!-- FOOTER: avatar + usuario + editar -->
    <mat-card-actions class="task-footer">
      <mat-icon>person</mat-icon>
      <span class="task-owner">{{ task.user?.username || 'Sin asignar' }}</span>
      <button
        mat-icon-button
        *ngIf="task.status.name !== 'Finished'"
        (click)="openUpdateForm(task)"
        aria-label="Editar"
      >
        <mat-icon>edit</mat-icon>
      </button>
    </mat-card-actions>

  </mat-card>
</ng-container>